---
- name: Create VS
  hosts: all
  gather_facts: false
  connection: local
    
  vars:
    uri_method: "POST"

  tasks:
  
  - set_fact:
     tenant_body: "{{ lookup('file', '../app-templates/{{ f5_template }}.json', split_lines=False) }}"
   
    ### AS3 POST ###
  - name: URI POST Tenant
    uri:
       url: "https://{{ inventory_hostname }}/mgmt/shared/appsvcs/declare"
       method: "{{ uri_method }}"
       headers:
          X-F5-Auth-Token: "eyJraWQiOiJmNzdhMTIxNi1hZGEwLTQ5OWMtYWEwNi1lZGViZjAxYWM0ZmQiLCJhbGciOiJSUzM4NCJ9.eyJpc3MiOiJCSUctSVEiLCJqdGkiOiJaYzUxaXAzSUQtWG5RaE1xV1JKaEpBIiwic3ViIjoiYWRtaW4iLCJhdWQiOiIxMC4xLjEuNiIsImlhdCI6MTU1MjIyMTkxNywiZXhwIjoxNTUyMjIyMjE3LCJ1c2VyTmFtZSI6ImFkbWluIiwiYXV0aFByb3ZpZGVyTmFtZSI6ImxvY2FsIiwidXNlciI6Imh0dHBzOi8vbG9jYWxob3N0L21nbXQvc2hhcmVkL2F1dGh6L3VzZXJzL2FkbWluIiwidHlwZSI6IkFDQ0VTUyIsInRpbWVvdXQiOjMwMCwiZ3JvdXBSZWZlcmVuY2VzIjpbXX0.cbuMuRM9z-RWfa3eFFCVbeFS5TfxEG0H5e1lY3XZCVgcLEJzqz-huk6w4D0y2Z7oEag9XzdbMpKo5_dQGcJFJKpxR8HZWg1vfzYw808v7Pp7XGx-SHUgtTe42GZq2-_oJEWUO6td6dIN56HFfcQdcRWUwVshIPedbP-Q6OTq_cH9p7AEu49AKcvuMu3KWHw4v5RYWl8-LIWYrV0fn4ZZbsZUFCU1Dky6JWTGN7hF8umOx2JZ2gWRXfUpIJoKrzG86_IiZm_qqDXR4M87nlWqRye9Zs2WEvNSoDQFc5H31H2KMlwq_Qpy1TEVQIe-BPjOoVLwwMUzQ6aQjDJFyw6Zl5cY9k070m_0MpuuCMVMC7MkHjgzJqmMwn9OlVZOxlJVfplXKBYINyIDjQ339WgSu4YihtPeW34MAt2pOkB8kbNmZJG8yFq2-MJ1ERKa69OHRgEevUJ2fqEl39ya-zYIdK0WIjTDwdo4ZfZwbaRFif6JPRm0qMuLaeCJW3-b6RBU"
       user: "admin"
       password: "admin"
       validate_certs: no
       body: "{{ lookup('template', '../j2/tenant_base_iq.j2') }}"
       body_format: json

