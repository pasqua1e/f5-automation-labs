---
- name: Create VS
  hosts: all
  gather_facts: false
  connection: local
    
  vars:
    uri_method: "POST"

  tasks:
  
  - set_fact:
     tenant_body: "{{ lookup('file', '../app-templates/{{ f5_template }}.json', split_lines=False) }}"
   
    ### AS3 POST ###
  - name: URI POST Tenant
    uri:
       url: "https://{{ inventory_hostname }}/mgmt/shared/appsvcs/declare?async=true"
       method: "{{ uri_method }}"
       headers:
          X-F5-Auth-Token: "eyJraWQiOiJmNzdhMTIxNi1hZGEwLTQ5OWMtYWEwNi1lZGViZjAxYWM0ZmQiLCJhbGciOiJSUzM4NCJ9.eyJpc3MiOiJCSUctSVEiLCJqdGkiOiJkNFB2M0MxUUVDMkY3UG1PeDVaRXlBIiwic3ViIjoiYWRtaW4iLCJhdWQiOiIxMC4xLjEuNCIsImlhdCI6MTU1MjIyMjgzNywiZXhwIjoxNTUyMjIzMTM3LCJ1c2VyTmFtZSI6ImFkbWluIiwiYXV0aFByb3ZpZGVyTmFtZSI6ImxvY2FsIiwidXNlciI6Imh0dHBzOi8vbG9jYWxob3N0L21nbXQvc2hhcmVkL2F1dGh6L3VzZXJzL2FkbWluIiwidHlwZSI6IkFDQ0VTUyIsInRpbWVvdXQiOjMwMCwiZ3JvdXBSZWZlcmVuY2VzIjpbXX0.BvFa6iTCPGxtnYUfT2sGnsUpCEAhjNg4RebhRDJxNnonx6vq4b8cV0TsHaUg2ruXWopRfy94lFi07VjKxVo3eS79AzKpodkWbTz0pbcpwW3olVm4hHEUc_kqOhXyyyuKbjGfaKm4NiaNzYk7n3mFZNYZXPgYVcAFdiBK9rJ15J2uu_JGb0kOdcsQbxamzh27FUj8HbHEdtrHewYqbWdcsxh1HyUvjKV-vlnFFfWdWYOn_pEzM0ZEco5ovH7COYmjAl6TKpZtsQdr6dneiwHinFNTstGmR4v3zOUADYBbpm8ef1L4na-09OO8RAENv7GTo4npH7FMYtLoOnsJBQj0geGBwEjikp8zef7Jmf6Oa10rFp9kq9loz3d0BpwUKQMoJEIUtUNkrOnQatO-yDMAG7XEOHN71xGJETBJGAdE8UVXnnv7D4ejo62adpTOW9RM2I7Yn7uiaUP5Kmqwywtb6pi4m4MHJHr2aVQw4yaM9CqfOolmmVJ9eABskXqo95DX"
       user: "admin"
       password: "admin"
       validate_certs: no
       body: "{{ lookup('template', '../j2/tenant_base_iq.j2') }}"
       body_format: json

